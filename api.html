<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>1kball</title>
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="assets/img/favicons/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="assets/img/favicons/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="assets/img/favicons/favicon-16x16.png"
    />
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="assets/img/favicons/favicon.ico"
    />
    <link rel="manifest" href="assets/img/favicons/manifest.json" />
    <meta
      name="msapplication-TileImage"
      content="assets/img/favicons/mstile-150x150.png"
    />
    <meta name="theme-color" content="#ffffff" />
    <link href="assets/css/theme.css" rel="stylesheet" />
    <link href="assets/css/custom_modal.css" rel="stylesheet" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/boxicons/2.1.0/css/animations.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/boxicons/2.1.0/css/boxicons.min.css"
    />
    <style>
      .glass-effect {
        background: rgba(
          255,
          255,
          255,
          0.1
        ); /* or use rgba(0, 0, 0, 0.2) for darker glass */
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px); /* for Safari */

        border: 1px solid rgba(255, 255, 255, 0.2);
      }
      .accheaderrows {
        background-color: #fff;
        height: 35px;
        line-height: 35px;
        border: solid 0.5 #eee;
        text-align: center;
      }

      .tbl-header {
        position: sticky;
        background-color: red;
        top: 0;
      }
      #api_result{
        padding: 20px;
        font-size: 25px;
        background-color: #fff;
      }
    </style>

    <style>
      li {
        list-style: none;
      }

      :root {
        --color-bg-primary: #d0d6df;
        --color-bg-primary-offset: #f1f3f7;
        --color-bg-secondary: #fff;
        --color-text-primary: #3a3c42;
        --color-text-primary-offset: #898c94;
        --color-orange: #dc9960;
        --color-green: #1eb8b1;
        --color-purple: #657cc4;
        --color-black: var(--color-text-primary);
        --color-red: #d92027;
      }

      body {
        font-family: "Inter", sans-serif;
        background-color: var(--color-bg-primary);
        color: var(--color-text-primary);
      }

      .menu {
        display: flex;
        flex-direction: column;
        border-radius: 0px;
        height: 500px;
        border: solid 1px #eee;
        position: relative;
        box-shadow: 0 10px 20px rgba(#404040, 0.15);
      }

      .menu-list {
        margin: 0;
        display: block;
        width: 100%;
        padding: 8px;
      }

      .menu-sub-list {
        display: none;
        padding: 8px;
        background-color: var(--color-bg-secondary);
        border-radius: 0px;
        box-shadow: rgba(100, 100, 111, 0.2) 0px 7px 29px 0px;
        position: absolute;
        left: 100%;
        right: 0;
        z-index: 100;
        width: 100%;
        top: 0;
        flex-direction: column;

        &:hover {
          display: flex;
        }
      }

      .menu-item {
        position: relative;
        padding: 3px;
      }

      .menu-button {
        font: inherit;
        border: 0;
        padding: 8px 8px;
        padding-right: 36px;
        width: 100%;
        border-radius: 0px;
        text-align: left;
        display: flex;
        align-items: center;
        position: relative;
        background-color: var(--color-bg-secondary);

        &:hover {
          background-color: var(--color-bg-primary-offset);

          & + .menu-sub-list {
            display: flex;
          }

          svg {
            stroke: var(--color-text-primary);
          }
        }

        svg {
          flex-shrink: 0;
          width: 20px;
          height: 20px;
          margin-right: 10px;
          stroke: var(--color-text-primary-offset);

          &:nth-of-type(2) {
            margin-right: 0;
            position: absolute;
            right: 8px;
          }
        }
      }

      .game-item {
        cursor: pointer;
      }

      .sticky-header {
        position: relative;
        bottom: 1px;
        box-shadow: rgba(50, 50, 93, 0.25) 0px 30px 60px -12px,
          rgba(0, 0, 0, 0.3) 0px 18px 36px -18px;
      }
      th {
        border: none;
      }
    </style>
  </head>

  <body>
    <main class="main" id="top">
      <nav
        class="navbar navbar-expand-lg navbar-light fixed-top py-3"
        data-navbar-on-scroll="data-navbar-on-scroll"
        style="
          background-color: #fff;
          box-shadow: rgba(0, 0, 0, 0.16) 0px 1px 4px;
        "
      >
        <div class="container">
          <a class="navbar-brand" href="index.html"
            ><img src="assets/img/icons/logo.png" alt="" width="30" /><span
              class="text-1000 fs-1 ms-2 fw-medium"
              >1Kball<span class="fw-bold"> Lottery</span></span
            ></a
          >
          <button
            class="navbar-toggler collapsed"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul
              class="navbar-nav mx-auto border-bottom border-lg-bottom-0 pt-2 pt-lg-0"
            >
              <li class="nav-item">
                <a class="nav-link" href="index.html">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="products.html">Products </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="result.html">Lottery Result</a>
              </li>
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="api.html"
                  >Result Api
                </a>
              </li>
            </ul>
            <div class="d-flex py-3 py-lg-0">
              <div style="display: inline-flex; gap: 2px">
                <button
                  style="
                    padding: 8px 15px;
                    border: 1px solid #ccc;
                    border-top-left-radius: 20px;
                    border-bottom-left-radius: 20px;
                  "
                >
                  English
                </button>
                <button
                  style="
                    padding: 8px 15px;
                    border: 1px solid #ccc;
                    border-top-right-radius: 20px;
                    border-bottom-right-radius: 20px;
                  "
                >
                  Chinese
                </button>
              </div>
            </div>
          </div>
        </div>
      </nav>

      <div style="height: 75px"></div>

      <section
        class="bg-100 py-7"
        style="background-image: url('assets/img/patterns/magic.png')"
      >
        <div class="container-lg">
          <div
            class="row h-100 justify-content-center"
            style="height: 400px; background-color: redx"
          >
            <div
              style="
                height: 40px;
                width: 76%;
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0 10px;
              "
            >
              <span>
                <b class="gameName"></b>
                <p class="gameInfo"></p>
              </span>
              <span class="streamer"></span>
            </div>
            <div
              class=""
              style="
                display: flex;
                height: auto;
                justify-content: center;
                align-items: center;
              "
            >
              <div class="menu">
                <div
                  style="
                    background-color: #fff;
                    height: 51px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    border-bottom: none;
                  "
                  class=""
                >
                  <th>
                    <span class="" data-key="">Game series</span>
                  </th>
                </div>
                <ul class="menu-list">
                  <li class="menu-item">
                    <button class="menu-button menu-button--black">
                      <i data-feather="circle"></i>5D Game Series<i
                        data-feather="chevron-right"
                      ></i>
                    </button>
                    <ul class="menu-sub-list" id="5d"></ul>
                  </li>
                  <li class="menu-item">
                    <button class="menu-button menu-button--black">
                      <i data-feather="circle"></i>3D Game Series<i
                        data-feather="chevron-right"
                      ></i>
                    </button>
                    <ul class="menu-sub-list" id="3d"></ul>
                  </li>
                  <li class="menu-item">
                    <button class="menu-button menu-button--black">
                      <i data-feather="circle"></i>Fast3 Game Series<i
                        data-feather="chevron-right"
                      ></i>
                    </button>
                    <ul class="menu-sub-list" id="fast3"></ul>
                  </li>
                  <li class="menu-item">
                    <button class="menu-button menu-button--black">
                      <i data-feather="circle"></i>PK10 Game Series
                      <i data-feather="chevron-right"></i>
                    </button>
                    <ul class="menu-sub-list" id="pk10"></ul>
                  </li>
                  <li class="menu-item">
                    <button class="menu-button menu-button--black">
                      <i data-feather="circle"></i>PC28 Game Series<i
                        data-feather="chevron-right"
                      ></i>
                    </button>
                    <ul class="menu-sub-list" id="pc28"></ul>
                  </li>
                  <li class="menu-item">
                    <button class="menu-button menu-button--black">
                      <i data-feather="circle"></i>Mark6 Game Series<i
                        data-feather="chevron-right"
                      ></i>
                    </button>
                    <ul class="menu-sub-list" id="mark6"></ul>
                  </li>
                  <li class="menu-item">
                    <button class="menu-button menu-button--black">
                      <i data-feather="circle"></i>11x5 Game Series<i
                        data-feather="chevron-right"
                      ></i>
                    </button>
                    <ul class="menu-sub-list" id="11x5"></ul>
                  </li>
                  <li class="menu-item">
                    <button class="menu-button menu-button--black">
                      <i data-feather="circle"></i>Happy8 Game Series<i
                        data-feather="chevron-right"
                      ></i>
                    </button>
                    <ul class="menu-sub-list" id="happy8"></ul>
                  </li>
                </ul>
                <!-- <ul class="menu-list">
                  <li class="menu-item"><button class="menu-button menu-button--delete"><i data-feather="trash-2"></i>PK6 Coming Soon!</button></li>
                </ul> -->
              </div>

              <!-- code here -->

              <div class="table-responsive mb-4 border rounded-1 table-wrapper acctablewrappers" id="api_result"
                style="
                  border: none;
                  width: 900px;
                  height: 500px;
                  position: relative;
                  top: 14px;
                ">
         
              </div>
            </div>
            <!-- <div id="pagination"></div> -->
          </div>
        </div>
      </section>

      <section
        class="bg-200 pt-5 pb-0"
        style="bottom: 0; padding: 0; position: relative"
      >
        <div class="container">
          <div class="row">
            <hr class="opacity-25" />
            <div class="text-400 text-center">
              <p>
                <img
                  class="d-inline-block align-middle"
                  src="assets/img/icons/logo.png"
                  alt=""
                  width="30"
                />
                <span
                  class="d-inline-block text-1000 fs-1 ms-2 fw-medium lh-base"
                  >1Kball <span class="fw-bold">Lottery</span></span
                >
                &copy; 2025 Enzerhub Coding Group
              </p>
            </div>
          </div>
        </div>
      </section>
    </main>

    <div
      id="dialog"
      class="dialog gradient-border"
      style="
        min-width: 600px;
        min-height: 400px;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 9999;
      "
    >
      <div class="overlay"></div>
      <div class="titlebar"></div>
      <button name="close" id="stopStream"></button>
      <div class="content" style="overflow: hidden" id="videoContainer">
        <video
          style="width: 100%; height: 100%"
          id="liveVideo"
          controls
          autoplay
        ></video>
      </div>
    </div>

    <template id="secret-template">
      <button
        class="btn order-0 playbtn"
        style="border: solid 1px #ccc; border-radius: 30px"
        onclick="showDefault($('.gameName').text());"
      >
        <i class="bx bx-camera-movie bx-flashing" style="color: #f53839"></i>
      </button>
    </template>

    <script src="assets/js/jquery.min.js"></script>
    <script src="vendors/@popperjs/popper.min.js"></script>
    <script src="vendors/bootstrap/bootstrap.min.js"></script>
    <script src="vendors/is/is.min.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=window.scroll"></script>
    <script src="assets/js/theme.js"></script>
    <script src="assets/js/bounce.min.js"></script>
    <script src="assets/js/custom_modal.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,300;1,400;1,500;1,600;1,700;1,800;1,900&amp;display=swap"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/boxicons/2.1.0/dist/boxicons.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flv.js/1.3.2/flv.min.js"></script>
    <script>
      // key variables
      let map = new Map();
      let live_socket = null;
      let video_socket = null;
      let flvPlayer = null;

      function showDefault(e = "Dialog Title") {
        let l;
        (l = new DialogBox("dialog", null)).showDialog();
        var t = new Bounce();
        t.scale({ from: { x: 0.2, y: 0.2 }, to: { x: 1, y: 1 } }),
          t.applyTo(document.querySelector(".dialog")),
          $(".titlebar").text(e),
          startStream();
        console.clear();
      }

      function startStream() {
        if (flvjs.isSupported()) {
          let e = document.getElementById("liveVideo");
          if (flvPlayer) {
            flvPlayer.play();
            return;
          }
          (flvPlayer = flvjs.createPlayer(
            {
              type: "flv",
              url: "https://a5bet.com/live/livestream.flv",
              isLive: !0,
              hasAudio: !1,
              hasVideo: !0,
            },
            {
              enableStashBuffer: !1,
              stashInitialSize: 128,
              autoCleanupSourceBuffer: !0,
              fixAudioTimestampGap: !0,
            }
          )).attachMediaElement(e),
            flvPlayer.load(),
            flvPlayer.play();
        }
      }

      async function fetchGames() {
        try {
          const response = await fetch("/1kball/public/test/getgamedata"); // Replace with your API endpoint
          const games = await response.json();

          for (game in games) {
            let items = "";
            games[game].forEach((item) => {
              items += `<li class="menu-item game-item" value="${item.id}|${item.name}|${item.details}"><button class="menu-button menu-button--purple"><i data-feather="octagon"></i>${item.name}</button></li>`;
            });
            document.getElementById(game).innerHTML = items;
          }
        } catch (error) {
          console.error("Error fetching games:", error);
        }
      }
      fetchGames();
      //feather.replace();

      const itemsPerPage = 11;
      let currentPage = 1;

      function renderPage(page, data) {
        const start = (page - 1) * itemsPerPage;
        const end = start + itemsPerPage;
        const paginatedItems = data.slice(start, end);
        let html = "";
        paginatedItems.reverse().forEach((item) => {
          html += `<tr style="text-align:center;height:36px">
                    <td>${item.draw_date}</td>
                    <td>${item.date_created}</td>
                    <td>${item.draw_number}</td>
                    <td>${item.draw_time}</td>
                  </tr>`;
        });
        $("#result-holder").html(html);

        renderPagination(data);
      }

      function renderPagination(data) {
        const pageCount = Math.ceil(data.length / itemsPerPage);
        const paginationContainer = document.getElementById("pagination");
        paginationContainer.innerHTML = "";

        for (let i = 1; i <= pageCount; i++) {
          const btn = document.createElement("button");
          btn.innerText = i;
          btn.onclick = () => {
            currentPage = i;
            renderPage(i, data);
          };
          if (i === currentPage) btn.disabled = true;
          paginationContainer.appendChild(btn);
        }
      }

      //pretify json in a div
      function syntaxHighlight(json) {
        json = json
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;");
        return json.replace(
          /("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,
          function (match) {
            var cls = "number";
            if (/^"/.test(match)) {
              if (/:$/.test(match)) {
                cls = "key";
              } else {
                cls = "string";
              }
            } else if (/true|false/.test(match)) {
              cls = "boolean";
            } else if (/null/.test(match)) {
              cls = "null";
            }
            return '<span class="' + cls + '">' + match + "</span>";
          }
        );
      }

      //do some handlers
      $(document).on("click", ".game-item", function () {
        let value = $(this).attr("value");
        let parts = value.split("|");
        let gameData = map.get(`${parts[0]}`);
        $(".gameName").text(parts[1]);
        $(".gameInfo").text(parts[2]);

        let html = "";
        let saveData = { id: parts[0], name: parts[1], details: parts[2] };
        localStorage.setItem("gameId", JSON.stringify(saveData));
        $("#api_result").empty();
        if (gameData.length == 0) {
          html += `<tr class="no-results">
              <td colspan="4">
                <img src="<?php echo BASE_URL; ?>assets/images/not_found.jpg" class="dark-logo" alt="Logo-Dark" />
              </td>
            </tr>`;
        } else {
          let cleanedData = gameData.map(({ drawid, game_id, get_time, client,date_created, ...rest }) => rest);
          let apis = {
            "Game Name": parts[1],
            "Total Count": "10",
            "Today's Date": "2025-05-09",
            "Data" : cleanedData.reverse()
          };
          const obj = JSON.stringify(apis, null, 8);
          $("#api_result").html("<pre>" + obj + "</pre>");
          liveDrawWss(parts[0]);
          liveVideo(parts[0]); // live
        }
      });

      function loadDefault() {
        let default_socket = new WebSocket("ws://localhost:2020?group=get_all");
        default_socket.onopen = () => {
          console.log("Connected to draw get_all WebSocket");
        };

        default_socket.onmessage = (event) => {
          const data = JSON.parse(event.data);
          //console.log("All games received:", data);
          for (games in data) {
            map.set(games, data[games]);
          }
          const custom = {
            id: "10001",
            name: "1kball 5D 1m",
            details:
              "1kball 5D 1m rules: daily 1380 00:00-23:59 1 minute period, maintenance time GMT+8 05:00-06:00 am",
          };
          const storedGame =
            localStorage.getItem("gameId") ?? JSON.stringify(custom);
          let json = JSON.parse(storedGame);
          console.log(storedGame);
          let gameData = map.get(`${json.id}`);
          $(".gameName").text(json.name);
          $(".gameInfo").text(json.details);
          let cleanedData = gameData.reverse().map(({ drawid, game_id, get_time, client,date_created, ...rest }) => rest);
          let apis = {
            "Game Name": json.name,
            "Total Count": "10",
            "Today's Date": "2025-05-09",
            "Data" : cleanedData
          };
          const obj = JSON.stringify(apis, null, 8);
          $("#api_result").html("<pre>" + obj + "</pre>");
          liveDrawWss(json.id);
          liveVideo(json.id); // live
        };

        default_socket.onclose = () => {
          console.log("WebSocket closed");
        };

        default_socket.onopen = () => {
          console.log("Connected to draw get_all WebSocket");
        };
      }

      function liveDrawWss(gameId = 10001) {
        if (
          live_socket &&
          (live_socket.readyState === WebSocket.OPEN ||
            live_socket.readyState === WebSocket.CONNECTING)
        ) {
          live_socket.close();
        }

        live_socket = new WebSocket(`ws://localhost:2020?group=${gameId}`);

        live_socket.onopen = () => {
          console.log("Connected to live draw WebSocket");
        };

        live_socket.onmessage = (event) => {
          const data = JSON.parse(event.data);
          console.log("Message received:", data);
          if (!data.type) {
            let cleanedData = gameData.reverse().map(({ drawid, game_id, get_time, client,date_created, ...rest }) => rest);
            let apis = {
              "Game Name": parts[1],
              "Total Count": "10",
              "Today's Date": "2025-05-09",
              "Data" : cleanedData
            };
            const obj = JSON.stringify(apis, null, 8);
            $("#api_result").html("<pre>" + obj + "</pre>");
          } else {
            if (data.result == "live") {
              $(".streamer").show();
            } else {
              $(".streamer").hide();
            }
          }
        };

        live_socket.onclose = () => {
          console.log("WebSocket closed");
        };
      }

      function liveVideo(gameId = 10001) {
        if (
          video_socket &&
          (video_socket.readyState === WebSocket.OPEN ||
            video_socket.readyState === WebSocket.CONNECTING)
        ) {
          video_socket.close();
        }

        video_socket = new WebSocket(
          `ws://localhost:2020?group=vid_state&gameid=` + gameId
        );

        video_socket.onopen = () => {
          console.log("liveVideo open");
        };

        video_socket.onmessage = (event) => {
          const data = JSON.parse(event.data);
          console.log("Message received:", data);

          if (data.result === "live") {
            const template = document.getElementById("secret-template");
            const clone = template.content.cloneNode(true);

            // Wrap the DocumentFragment content in jQuery and append
            $(".streamer").empty().append($(clone));
          } else {
            $(".playbtn").remove();
          }
        };

        video_socket.onclose = () => {
          console.log("liveVideo closed");
        };
      }

      function storeDrawWss() {
        let draw_socket = new WebSocket(
          "ws://localhost:2020?group=draw_storage"
        );
        draw_socket.onopen = () => {
          console.log("Connected to draw storage WebSocket");
        };

        draw_socket.onmessage = (event) => {
          const data = JSON.parse(event.data);
          // console.log("Message received:", data);
          for (games in data) {
            map.set(games, data[games]);
          }
          console.log(map);
        };

        draw_socket.onclose = () => {
          console.log("WebSocket closed");
        };

        draw_socket.onopen = () => {
          console.log("Connected to draw storage WebSocket");
        };

        draw_socket.onmessage = (event) => {
          const data = JSON.parse(event.data);
          // console.log("Message received:", data);
          for (games in data) {
            map.set(games, data[games]);
          }
          console.log(map);
        };

        draw_socket.onclose = () => {
          console.log("WebSocket closed");
        };
      }

      liveDrawWss();
      storeDrawWss();
      loadDefault();

    </script>
  </body>
</html>
