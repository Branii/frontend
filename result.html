<!DOCTYPE html>
<html lang="en-US" dir="ltr">

  <head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>1kball</title>
    <link rel="apple-touch-icon" sizes="180x180" href="assets/img/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/img/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/img/favicons/favicon-16x16.png">
    <link rel="shortcut icon" type="image/x-icon" href="assets/img/favicons/favicon.ico">
    <link rel="manifest" href="assets/img/favicons/manifest.json">
    <meta name="msapplication-TileImage" content="assets/img/favicons/mstile-150x150.png">
    <meta name="theme-color" content="#ffffff">
    <link href="assets/css/theme.css" rel="stylesheet" />

    <style>
      .glass-effect {
        background: rgba(255, 255, 255, 0.1); /* or use rgba(0, 0, 0, 0.2) for darker glass */
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px); /* for Safari */
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        padding: 1rem;
      }
      .accheaderrows{
        background-color: #fff;
        height:35px;
        line-height: 35px;
        border: solid .5 #eee;
        text-align: center;
      }

      .tbl-header {
        position: sticky;
        background-color: red;
        top: 0;
      }

    </style>
    
    <style>
    
      li {
        list-style: none;
      }
    
      :root {
        --color-bg-primary: #d0d6df;
        --color-bg-primary-offset: #f1f3f7;
        --color-bg-secondary: #fff;
        --color-text-primary: #3a3c42;
        --color-text-primary-offset: #898c94;
        --color-orange: #dc9960;
        --color-green: #1eb8b1;
        --color-purple: #657cc4;
        --color-black: var(--color-text-primary);
        --color-red: #d92027;
      }
    
      body {
        font-family: "Inter", sans-serif;
        background-color: var(--color-bg-primary);
        color: var(--color-text-primary);
      }
    
      .menu {
        display: flex;
        flex-direction: column;
        background-color: var(--color-bg-secondary);
        border-radius: 0px;
        height: 500px;
        border: solid 1px #eee;
        position: relative;
        box-shadow: 0 10px 20px rgba(#404040, 0.15);
      }
    
      .menu-list {
        margin: 0;
        display: block;
        width: 100%;
        padding: 8px;
    
        &+.menu-list {
          border-top: 1px solid #ddd;
        }
      }
    
      .menu-sub-list {
        display: none;
        padding: 8px;
        background-color: var(--color-bg-secondary);
        border-radius: 10px;
        box-shadow: rgba(100, 100, 111, 0.2) 0px 7px 29px 0px;
        position: absolute;
        left: 100%;
        right: 0;
        z-index: 100;
        width: 100%;
        top: 0;
        flex-direction: column;
    
        &:hover {
          display: flex;
        }
      }
    
      .menu-item {
        position: relative;
        padding: 3px;
      }
    
      .menu-button {
        font: inherit;
        border: 0;
        padding: 8px 8px;
        padding-right: 36px;
        width: 100%;
        border-radius: 8px;
        text-align: left;
        display: flex;
        align-items: center;
        position: relative;
        background-color: var(--color-bg-secondary);
    
        &:hover {
          background-color: var(--color-bg-primary-offset);
    
          &+.menu-sub-list {
            display: flex;
          }
    
          svg {
            stroke: var(--color-text-primary);
          }
        }
    
        svg {
          flex-shrink: 0;
          width: 20px;
          height: 20px;
          margin-right: 10px;
          stroke: var(--color-text-primary-offset);
    
          &:nth-of-type(2) {
            margin-right: 0;
            position: absolute;
            right: 8px;
          }
        }
    
    
      }

    
      .game-item {
        cursor: pointer;
      }
    
      .sticky-header {
        position: relative;
        bottom: 1px;
        box-shadow: rgba(50, 50, 93, 0.25) 0px 30px 60px -12px, rgba(0, 0, 0, 0.3) 0px 18px 36px -18px;
      }
    
    </style> 
  </head>


  <body>

    <main class="main" id="top">

      <nav class="navbar navbar-expand-lg navbar-light fixed-top py-3" data-navbar-on-scroll="data-navbar-on-scroll" style="background-color: #fff;box-shadow: rgba(0, 0, 0, 0.16) 0px 1px 4px;">
        <div class="container"><a class="navbar-brand" href="#"><img src="assets/img/icons/logo.png" alt="" width="30" /><span class="text-1000 fs-1 ms-2 fw-mediu        <div class="container"><a class="navbar-brand" href="index.html"><img src="assets/img/icons/logo.png" alt="" width="30" /><span class="text-1000 fs-1 ms-2 fw-medium">1Kball<span class="fw-bold"> Lottery</span></span></a>
          <button class="navbar-toggler collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mx-auto border-bottom border-lg-bottom-0 pt-2 pt-lg-0">
              <li class="nav-item"><a class="nav-link" aria-current="page" href="index.html">Home</a></li>
              <li class="nav-item"><a class="nav-link" href="products.html">Products </a></li>
              <li class="nav-item"><a class="nav-link active" href="#">Lottery Result</a></li>
              <button class="btn btn-link text-1000 fw-medium order-1 order-lg-0" type="button">Sign in</button>
              <button class="btn btn-outline-danger rounded-pill order-0" type="submit">Help</button>
            </form>
          </div>
        </div>
      </nav>

      <div style="height:90px"></div>

      <section class="bg-100 py-7" style="background-image: url('assets/img/patterns/magic.png');">
        <div class="container-lg">
          <div class="row h-100 justify-content-center" style="height:400px;background-color:redx">
            <div style="height: 40px; width:76%;display: flex; justify-content: space-between; align-items: center; padding: 0 10px;">
              <span>
                <b class="gameName"></b>
                <p class="gameInfo"></p>
              </span>
              <span><button class="btn btn-outline-danger rounded-pill order-0" type="submit">Help</button></span>
            </div>
            <div class="" style="display: flex;height:auto;justify-content: center;align-items: center;">
                <div class="menu ">
                <div style="height:53px; display: flex; align-items: center; justify-content: center;border-bottom:solid 1px #eee" class="">
                  <th>
                    <span class="" data-key="">Game series</span>
                  </th>
                </div>
                <ul class="menu-list ">
                  <li class="menu-item"><button class="menu-button menu-button--black"><i data-feather="circle"></i>5D Game Series<i data-feather="chevron-right"></i></button>
                    <ul class="menu-sub-list" id="5d"></ul>
                  </li>
                  <li class="menu-item"><button class="menu-button menu-button--black"><i data-feather="circle"></i>3D Game Series<i data-feather="chevron-right"></i></button>
                    <ul class="menu-sub-list" id="3d"></ul>
                  </li>
                  <li class="menu-item"><button class="menu-button menu-button--black"><i data-feather="circle"></i>Fast3 Game Series<i data-feather="chevron-right"></i></button>
                    <ul class="menu-sub-list" id="fast3"></ul>
                  </li>
                  <li class="menu-item"><button class="menu-button menu-button--black"><i data-feather="circle"></i>PK10 Game Series <i data-feather="chevron-right"></i></button>
                    <ul class="menu-sub-list" id="pk10"></ul>
                  </li>
                  <li class="menu-item"><button class="menu-button menu-button--black"><i data-feather="circle"></i>PC28 Game Series<i data-feather="chevron-right"></i></button>
                    <ul class="menu-sub-list" id="pc28"></ul>
                  </li>
                  <li class="menu-item"><button class="menu-button menu-button--black"><i data-feather="circle"></i>Mark6 Game Series<i data-feather="chevron-right"></i></button>
                    <ul class="menu-sub-list" id="mark6"></ul>
                  </li>
                  <li class="menu-item"><button class="menu-button menu-button--black"><i data-feather="circle"></i>11x5 Game Series<i data-feather="chevron-right"></i></button>
                    <ul class="menu-sub-list" id="11x5"></ul>
                  </li>
                  <li class="menu-item"><button class="menu-button menu-button--black"><i data-feather="circle"></i>Happy8 Game Series<i data-feather="chevron-right"></i></button>
                    <ul class="menu-sub-list" id="happy8"></ul>
                  </li>
                </ul>
                <ul class="menu-list">
                  <li class="menu-item"><button class="menu-button menu-button--delete"><i data-feather="trash-2"></i>Test 1</button></li>
                </ul>
                </div>
            
                <!-- code here -->
        
                <div class="table-responsive mb-4 border rounded-1 table-wrapper acctablewrappers" id="partners_mask" style="width:900px;height:500px;position:relative;top:14px;">              
                <table class="table text-nowrap mb-0 align-middle table-hover table-striped" style="max-height:415px;overflow-y:scroll;">
                  <thead class="text-dark tbl-header">
                    <tr class="accheaderrows">
                      <th>
                        <span class=" fw-semibold mb-0 translatable" data-key="">Draw period</span>
                      </th>
                      <th>
                        <span class=" fw-semibold mb-0 translatable" data-key="">Draw date</span>
                      </th>
                      <th>
                        <span class=" fw-semibold mb-0 translatable" data-key="">Draw number</span>
                      </th>
                      <th>
                        <span class=" fw-semibold mb-0 translatable" data-key="">Draw time</span>
                      </th>
                    </tr>
                  </thead>
                  <tbody id="result-holder" class="tbl-content">
            
                    <!-- <tr class="no-results">
                        <td colspan="9">
                          <img src="<?php echo BASE_URL; ?>assets/images/not_found.jpg" class="dark-logo" alt="Logo-Dark" />
                        </td>
                      </tr> -->
            
                  </tbody>
                </table> 
                </div>    
            </div>
            <!-- <div id="pagination"></div> -->
          </div>
        </div>
      </section>

    </main>
    <script src="assets/js/jquery.min.js"></script>
    <script src="vendors/@popperjs/popper.min.js"></script>
    <script src="vendors/bootstrap/bootstrap.min.js"></script>
    <script src="vendors/is/is.min.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=window.scroll"></script>
    <script src="assets/js/theme.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,300;1,400;1,500;1,600;1,700;1,800;1,900&amp;display=swap" rel="stylesheet">
    <script>
      // key variables
      let map = new Map();
      let live_socket = null;
    
      async function fetchGames() {
        try {
          const response = await fetch('/1kball/public/test/getgamedata'); // Replace with your API endpoint
          const games = await response.json();
    
          for (game in games) {
            let items = '';
            games[game].forEach((item) => {
              items += `<li class="menu-item game-item" value="${item.id}|${item.name}|${item.details}"><button class="menu-button menu-button--purple"><i data-feather="octagon"></i>${item.name}</button></li>`
            })
            document.getElementById(game).innerHTML = items
          }
    
        } catch (error) {
          console.error('Error fetching games:', error);
        }
      }
      fetchGames();
      //feather.replace();

      const itemsPerPage = 11;
      let currentPage = 1;

      function renderPage(page,data) {
          const start = (page - 1) * itemsPerPage;
          const end = start + itemsPerPage;
          const paginatedItems = data.slice(start, end);
              let html = ''
              paginatedItems.reverse().forEach((item) => {
                html += `<tr style="text-align:center;height:36px">
                    <td>${item.draw_date}</td>
                    <td>${item.date_created}</td>
                    <td>${item.draw_number}</td>
                    <td>${item.draw_time}</td>
                  </tr>`;
              })
              $('#result-holder').html(html)

          renderPagination(data);
      }

      function renderPagination(data) {
        const pageCount = Math.ceil(data.length / itemsPerPage);
        const paginationContainer = document.getElementById("pagination");
        paginationContainer.innerHTML = '';
    
        for (let i = 1; i <= pageCount; i++) {
            const btn = document.createElement("button");
            btn.innerText = i;
            btn.onclick = () => {
                currentPage = i;
                renderPage(i,data);
            };
            if (i === currentPage) btn.disabled = true;
            paginationContainer.appendChild(btn);
        }
      }
    
      //do some handlers
      $(document).on('click', '.game-item', function() {
        let value = $(this).attr("value");
        let parts = value.split("|"); 
        let gameData = map.get(`${parts[0]}`)
        $(".gameName").text(parts[1])
        $(".gameInfo").text(parts[2])
        let html = '';
        let saveData = {id:parts[0],name:parts[1],details:parts[2]}
        localStorage.setItem("gameId", JSON.stringify(saveData))
        $('#result-holder').empty()
        if(gameData.length == 0){
          html += `<tr class="no-results">
              <td colspan="4">
                <img src="<?php echo BASE_URL; ?>assets/images/not_found.jpg" class="dark-logo" alt="Logo-Dark" />
              </td>
            </tr>`
        }else{
        gameData.reverse().forEach((item) => {
          html += `<tr style="text-align:center;height:36px">
              <td>${item.draw_date}</td>
              <td>${item.date_created}</td>
              <td>${item.draw_number}</td>
              <td>${item.draw_time}</td>
            </tr>`;
        })
        $('#result-holder').append(html)
        liveDrawWss(parts[0])
    
      }
      })

      function loadDefault(){
        let default_socket = new WebSocket("ws://localhost:2020?group=get_all");
        default_socket.onopen = () => {
          console.log("Connected to draw get_all WebSocket");
        };
    
        default_socket.onmessage = (event) => {
            const data = JSON.parse(event.data);
            //console.log("All games received:", data);
            for(games in data){
              map.set(games, data[games])
            }
            const custom = {id:"10001",name:"1kball 5D 1m",details:"1kball 5D 1m rules: daily 1380 00:00-23:59 1 minute period, maintenance time GMT+8 05:00-06:00 am"}
            const storedGame = localStorage.getItem("gameId") ?? JSON.stringify(custom)
            let json = JSON.parse(storedGame)
            console.log(storedGame)
            let gameData = map.get(`${json.id}`)
            $(".gameName").text(json.name)
            $(".gameInfo").text(json.details)
            let html = '';
            gameData.reverse().forEach((item) => {
              html += `<tr style="text-align:center;height:36px">
                  <td>${item.draw_date}</td>
                  <td>${item.date_created}</td>
                  <td>${item.draw_number}</td>
                  <td>${item.draw_time}</td>
                </tr>`;
            })
            $('#result-holder').html(html)
            liveDrawWss(json.id)
        };
    
        default_socket.onclose = () => {
          console.log("WebSocket closed");
        };
    
        default_socket.onopen = () => {
          console.log("Connected to draw get_all WebSocket");
        };
    
        default_socket.onclose = () => {
          console.log("WebSocket closed");
        };
      }
    
      function liveDrawWss(gameId=10001) {
    
        if (live_socket && (live_socket.readyState === WebSocket.OPEN || live_socket.readyState === WebSocket.CONNECTING)) {
            live_socket.close();
        }
    
        live_socket = new WebSocket(`ws://localhost:2020?group=${gameId}`);
    
        live_socket.onopen = () => {
          console.log("Connected to live draw WebSocket");
        };
    
        live_socket.onmessage = (event) => {
          const data = JSON.parse(event.data);
          console.log("Message received:", data);
          const playerList = document.getElementById("result-holder");
          let html = "";
          html += `<tr style="text-align:center;height:36px">
              <td>${data.draw_date}</td>
              <td>${data.date_created}</td>
              <td>${data.draw_number}</td>
              <td>${data.draw_time}</td>
            </tr>`;
          playerList.insertAdjacentHTML("afterbegin", html);
        };
    
        live_socket.onclose = () => {
          console.log("WebSocket closed");
        };
      }
    
      function storeDrawWss() {
    
        let draw_socket = new WebSocket("ws://localhost:2020?group=draw_storage");
        draw_socket.onopen = () => {
          console.log("Connected to draw storage WebSocket");
        };
    
        draw_socket.onmessage = (event) => {
            const data = JSON.parse(event.data);
            // console.log("Message received:", data);
            for(games in data){
              map.set(games, data[games])
            }
            console.log(map)
        };
    
        draw_socket.onclose = () => {
          console.log("WebSocket closed");
        };
    
        draw_socket.onopen = () => {
          console.log("Connected to draw storage WebSocket");
        };
    
        draw_socket.onmessage = (event) => {
            const data = JSON.parse(event.data);
            // console.log("Message received:", data);
            for(games in data){
              map.set(games, data[games])
            }
            console.log(map)
        };
    
        draw_socket.onclose = () => {
          console.log("WebSocket closed");
        };
      }
    
      liveDrawWss()
      storeDrawWss()
      loadDefault()
    
      const tableContainers = document.querySelectorAll(".acctablewrappers");
      const headerRows = document.querySelectorAll(".accheaderrows");
    
      tableContainers.forEach((tableContainer, index) => {
        const headerRow = headerRows[index];
        tableContainer.addEventListener("scroll", function() {
          if (tableContainer.scrollTop > 0) {
            console.log("scrolled", index);
            headerRow.classList.add("sticky-header");
          } else {
            console.log("not scrolled", index);
            headerRow.classList.remove("sticky-header");
          }
        });
      });
    </script>
  </body>

</html>